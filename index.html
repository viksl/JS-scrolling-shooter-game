<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8" />
		<title>BoxBox</title>

	<style>
		* {
			padding: 0;
			margin: 0;
		}
		
		html, body {
			width: 100%;
			height: 100%;
			overflow: hidden;
			display: block;
		}
		
		#gameDiv {
			position: fixed;
			left: 50%;
			top: 50%;
			transform:translate(-50%, -50%);
			-webkit-transform:translate(-50%, -50%);
			-moz-transform:translate(-50%, -50%);
			-o-transform:translate(-50%, -50%);
			-ms-transform:translate(-50%, -50%);
			
		}
	</style>
	
	</head>
	
	<body>
		<div id="gameDiv">
			<canvas id="bg"></canvas>
			<canvas id="main"></canvas>
			<canvas id="fg"></canvas>
		</div>
		<script type="text/javascript">var vec={};vec.init=function(){this.unit=20,this.colors=["#FFA200","#D61E15","#C929C2","#9222D9","#2AE220","#355F6C"],this.pause={state:!1,active:!1,time:0,diff:0},this.bulletLife=2,this.gameOver=!1,this.score=0,this.reverse={time:0,condition:5,alive:!0},this.reverse.update=function(){if(this.time+=vec.timeStep,this.time>this.condition){var e=this.time-this.condition;this.time=e,vec.dir*=-1;var t=[],i=0;if(vec.bullets.neutral.forEach(function(e,i){e.life--,e.life<0&&(e.kill=!0,e.render=!1,e.alive=!1,t.push(i))}),t&&t.length>0)for(var h=0;h<t.length;h++)t[h]>=0&&(vec.bullets.neutral.splice(t[h]-i,1),i++);for(var h=0;h<vec.bullets.player.length;h++)vec.bullets.player[h].life--,vec.bullets.player[h].source="neutral",vec.bullets.neutral.push(vec.bullets.player[h]);for(var h=0;h<vec.bullets.enemies.length;h++)vec.bullets.enemies[h].life--,vec.bullets.enemies[h].source="neutral",vec.bullets.neutral.push(vec.bullets.enemies[h]);vec.bullets.player.length=0,vec.bullets.enemies.length=0}},this.lastTime=null,this.timeStep=0,this.baseWidth=480,this.baseHeight=720,this.windowWidth=Math.floor(window.innerWidth),this.windowHeight=Math.floor(window.innerHeight),this.ratioW=this.windowWidth/this.baseWidth,this.ratioH=this.windowHeight/this.baseHeight,this.maxHealth=100,this.ratioW<this.ratioH?(this.width=Math.floor(this.windowWidth),this.height=Math.floor(this.width*this.baseHeight/this.baseWidth)):(this.height=Math.floor(this.windowHeight),this.width=Math.floor(this.height*this.baseWidth/this.baseHeight)),this.div=document.getElementById("gameDiv"),this.div.style.width=this.width+"px",this.div.style.height=this.height+"px",this.widthOld=this.width,this.heightOld=this.height,this.scaleX=this.width/this.widthOld,this.scaleY=this.height/this.heightOld,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.ratioX=this.width/this.baseWidth,this.ratioY=this.height/this.baseHeight,this.factorX=this.unit*this.ratioX,this.factorY=this.unit*this.ratioY,this.dir=1,this.ctx={},this.group={render:[],update:[]},this.group.update.push(this.reverse),this.player={},this.group.render.push(this.player),this.group.update.push(this.player),this.bullets={},this.bullets.pool=[],this.bullets.enemies=[],this.bullets.player=[],this.bullets.neutral=[],this.group.render.push(this.bullets.player),this.group.update.push(this.bullets.player),this.group.render.push(this.bullets.enemies),this.group.update.push(this.bullets.enemies),this.group.render.push(this.bullets.neutral),this.group.update.push(this.bullets.neutral),this.enemies=[],this.group.render.push(this.enemies),this.group.update.push(this.enemies),this.getFirstDead=function(e){for(var t=0;t<e.length;t++){if(!e[t].alive)return e[t];if(t===e.length-1)return!1}},this.timers={enemy:{elapsed:0,timer:4},bonus:{elapsed:0,timer:3.5},gameProgress:{elapsed:0,timer:10},increaseFireRate:{elapsed:0,timer:5}},this.spawnSpots=.75,this.enemyTypes=["straight","straightStop","straightStop","sin","sinStop","sinStop"],this.enemyBaseSize=2,this.bonuses=["shield","shield","shield","firerate","firerate","firepower","firepower","shipDestruction","bulletDestruction","changeDirection","changeDirection"],this.firePowers=["playerBasicHorizontal","playerBasicDiagonalR","playerBasicDiagonalL"],this.bonusesId=[],this.decreaseFireRate=1.5,this.enemyCount=0,this.spawn={alive:!0},this.group.update.push(this.spawn),this.spawn.update=function(){if(vec.timers.gameProgress.elapsed+=vec.timeStep,vec.timers.gameProgress.elapsed>vec.timers.gameProgress.timer){var e=vec.timers.gameProgress.elapsed-vec.timers.gameProgress.timer;vec.timers.gameProgress.elapsed=e,vec.timers.enemy.timer>.9&&(vec.timers.enemy.timer-=.3),vec.timers.bonus.timer>.9&&(vec.timers.bonus.timer-=.4)}if(vec.timers.increaseFireRate.elapsed+=vec.timeStep,vec.timers.increaseFireRate.elapsed>vec.timers.increaseFireRate.timer){var e=vec.timers.increaseFireRate.elapsed-vec.timers.increaseFireRate.timer;vec.timers.increaseFireRate=e,vec.decreaseFireRate>0&&(vec.decreaseFireRate-=.3),vec.decreaseFireRate<0&&(vec.decreaseFireRate=0)}if(vec.timers.enemy.elapsed+=vec.timeStep,vec.timers.enemy.elapsed>vec.timers.enemy.timer||vec.enemyCount<4){if(vec.enemyCount>0){var e=vec.timers.enemy.elapsed-vec.timers.enemy.timer;vec.timers.enemy.elapsed=e}var t=Math.random(),i=Math.random(),h=[],c=Math.random(),s=Math.floor(3*Math.random())-1;if(.1>=c){h=[s,-1];var o="b"}else if(.35>=c){h=[1,s];var o="l"}else if(.6>=c){h=[-1,s];var o="r"}else if(1>=c){h=[s,1];var o="t"}vec.createEnemy(vec.enemyTypes[Math.floor(c*vec.enemyTypes.length)],h,t,i,o)}if(vec.timers.bonus.elapsed+=vec.timeStep,vec.timers.bonus.elapsed>vec.timers.bonus.timer){var e=vec.timers.bonus.elapsed-vec.timers.bonus.timer;vec.timers.bonus.elapsed=e;var a={};switch(a.velocity={x:0,y:13},a.id=vec.bonusesId.length,vec.bonusesId.push(a.id),a.width=1.5,a.height=1.5,a.alive=!0,a.render=!0,a.kill=!1,a.x=Math.floor(Math.random()*(1+.9*vec.width-.1*vec.width))+Math.floor(.1*vec.width),a.y=-2*a.height*vec.factorY,a.type=vec.bonuses[Math.floor(Math.random()*vec.bonuses.length)],a.type){case"shield":a.color="#FFFA00",a.effect=function(){vec.player.shield.type=vec.colors[Math.floor(Math.random()*vec.colors.length)],vec.player.shield.health=vec.player.shield.max};break;case"firerate":a.color="#00A6A0",a.effect=function(){vec.player.fireMaxEvent.on?vec.player.fireMaxEvent.timeElapsed=0:(vec.addEvent(vec.player,vec.player.maxFireRate,"playerBasicVertical"),vec.player.fireMaxEvent.on=!0,vec.player.fireMaxEvent.index=vec.player.events.length-1)};break;case"firepower":a.color="#BD006B",a.effect=function(){if(vec.firePowers.length){var e=Math.floor(Math.random()*vec.firePowers.length);vec.addEvent(vec.player,vec.player.fireRate,vec.firePowers[e]),vec.firePowers.splice(e,1)}if(!(vec.player.fireRate<3*vec.player.maxFireRate)){vec.player.fireRate-=.05;for(var t=0;t<vec.player.events.length;t++)vec.player.events[t].condition=vec.player.fireMaxEvent.index!==!1&&t!==vec.player.fireMaxEvent.index?vec.player.fireRate:vec.player.fireRate}};break;case"shipDestruction":a.color="#C82FFF",a.effect=function(){vec.score+=50*vec.enemies.length,vec.enemies.length=0,vec.enemyCount=0};break;case"bulletDestruction":a.color="#451EF6",a.effect=function(){vec.bullets.enemies.length=0,vec.bullets.player.length=0,vec.bullets.neutral.length=0};break;case"changeDirection":a.color="#19F74A",a.effect=function(){vec.reverse.time=vec.reverse.condition}}a.update=function(){this.y+=this.velocity.y*vec.factorY*vec.timeStep;var e=!1;if(e=vec.boxCollision(this.x,this.y,this.width*vec.factorX,this.height*vec.factorY,vec.player.x,vec.player.y,vec.player.width*vec.factorX,vec.player.height*vec.factorY)){this.effect(),vec.score+=200,this.kill=!0,this.alive=!1,this.render=!1;for(var t=0;t<vec.group.update.length;t++)vec.group.update[t].type&&"shield"===vec.group.update[t].type&&vec.group.update[t].id===this.id&&vec.group.update.splice(t,1);for(var t=0;t<vec.group.render.length;t++)vec.group.render[t].type&&"shield"===vec.group.render[t].type&&vec.group.render[t].id===this.id&&vec.group.render.splice(t,1)}},a.draw=function(){var e=Math.floor(this.width*vec.factorX)/10;vec.ctx.main.fillStyle="#000000",vec.ctx.main.fillRect(this.x,this.y,Math.floor(this.width*vec.factorX),Math.floor(this.height*vec.factorY)),vec.ctx.main.fillStyle=vec.shadeColor2(this.color,.5),vec.ctx.main.fillRect(this.x+e,this.y+e,Math.floor(this.width*vec.factorX-2*e),Math.floor(this.height*vec.factorY-2*e)),vec.ctx.main.fillStyle=vec.shadeColor2(this.color,-.2),vec.ctx.main.fillRect(this.x,this.y,Math.floor(this.width*vec.factorX*.35),Math.floor(this.height*vec.factorY*.35)),vec.ctx.main.fillRect(this.x+Math.floor(this.width*vec.factorX-this.width*vec.factorX*.35),this.y,Math.floor(this.width*vec.factorX*.35),Math.floor(this.height*vec.factorY*.35)),vec.ctx.main.fillRect(this.x,this.y+Math.floor(this.height*vec.factorY-this.height*vec.factorY*.35),Math.floor(this.width*vec.factorX*.35),Math.floor(this.height*vec.factorY*.35)),vec.ctx.main.fillRect(this.x+Math.floor(this.width*vec.factorX-this.width*vec.factorX*.35),this.y+Math.floor(this.height*vec.factorY-this.height*vec.factorY*.35),Math.floor(this.width*vec.factorX*.35),Math.floor(this.height*vec.factorY*.35))},vec.group.update.push(a),vec.group.render.push(a)}},this.test=0,this.shadeColor2=function(e,t){var i=parseInt(e.slice(1),16),h=0>t?0:255,c=0>t?-1*t:t,s=i>>16,o=i>>8&255,a=255&i;return"#"+(16777216+65536*(Math.round((h-s)*c)+s)+256*(Math.round((h-o)*c)+o)+(Math.round((h-a)*c)+a)).toString(16).slice(1)},this.blendColors=function(e,t,i){var h=parseInt(e.slice(1),16),c=parseInt(t.slice(1),16),s=h>>16,o=h>>8&255,a=255&h,r=c>>16,l=c>>8&255,v=255&c;return"#"+(16777216+65536*(Math.round((r-s)*i)+s)+256*(Math.round((l-o)*i)+o)+(Math.round((v-a)*i)+a)).toString(16).slice(1)},this.createEnemy=function(e,t,i,h,c){for(var s,o,a=[[0,0],[1,0],[2,0],[0,1],[2,1],[0,2],[1,2],[2,2]],r=Math.floor(3*Math.random())+1,l=Math.floor(3*Math.random())+1,v=Math.random(),n=Math.floor(7*Math.random())+2,d=Math.floor(7*Math.random())+2,f={n:Math.floor(3*Math.random())+1,d:Math.floor(3*Math.random())+1},g=0;r*l>g;g++){switch(s=0,o=0,c){case"t":switch(o=Math.floor(0-3*vec.enemyBaseSize*vec.factorY),t[0]){case-1:s=Math.floor(vec.width-vec.enemyBaseSize*vec.factorX*3-v*(vec.width-vec.enemyBaseSize*vec.factorX*3)*vec.spawnSpots/2);break;case 0:s=Math.floor(v*(vec.width-vec.enemyBaseSize*vec.factorX*3));break;case 1:s=Math.floor(v*vec.width*vec.spawnSpots/2)}break;case"l":switch(s=Math.floor(0-3*vec.enemyBaseSize*vec.factorX),t[1]){case-1:o=Math.floor(vec.height-vec.enemyBaseSize*vec.factorY*3-v*(vec.height-vec.enemyBaseSize*vec.factorY*3)*vec.spawnSpots/2);break;case 0:o=Math.floor(v*(vec.height-vec.enemyBaseSize*vec.factorY*3));break;case 1:o=Math.floor(v*vec.height*vec.spawnSpots/2)}break;case"r":switch(s=vec.width,t[1]){case-1:o=Math.floor(vec.height-vec.enemyBaseSize*vec.factorY*3-v*(vec.height-vec.enemyBaseSize*vec.factorY*3)*vec.spawnSpots/2);break;case 0:o=Math.floor(v*(vec.height-vec.enemyBaseSize*vec.factorY*3));break;case 1:o=Math.floor(v*vec.height*vec.spawnSpots/2)}break;case"b":switch(o=vec.height,t[0]){case-1:s=Math.floor(vec.width-vec.enemyBaseSize*vec.factorX*3-v*(vec.width-vec.enemyBaseSize*vec.factorX*3)*vec.spawnSpots/2);break;case 0:s=Math.floor(v*(vec.width-vec.enemyBaseSize*vec.factorX*3));break;case 1:s=Math.floor(v*vec.width*vec.spawnSpots/2)}}if(0===g)s+=vec.enemyBaseSize*vec.factorX|0,o+=vec.enemyBaseSize*vec.factorY|0;else{var u=Math.floor(Math.random()*a.length);s+=a[u][0]*vec.enemyBaseSize*vec.factorX|0,o+=a[u][1]*vec.enemyBaseSize*vec.factorY|0,a.splice(u,1)}var p=vec.getFirstDead(vec.enemies);if(p?vec.Enemy(s,o,e,t,i,h,!0,n,d,f,p):(p=new vec.Enemy(s,o,e,t,i,h,!0,n,d,f),vec.enemies.push(p)),vec.enemyCount++,0===g){var m=p;m.parent=!0,m.id=vec.test,m.children=[],vec.test++}else m.children.push(p),p.parent=m.id,p.id=vec.test-1;p=null}m=null},this.boxCollision=function(e,t,i,h,c,s,o,a){return c+o>e&&e+i>c&&s+a>t&&h+t>s?!0:!1},this.removeFromArray=function(e,t){for(var i=0,h=0;h<t.length;h++)t[h]>=0&&(e.splice(t[h]-i,1),i++)},this.Enemy=function(e,t,i,h,c,s,o,a,r,l,v){if(v)var n=v;else var n=this;switch(n.width=1.3,n.height=1.3,n.x=e,n.y=t,n.prevX=e,n.prevY=t,n.color=vec.colors[Math.floor(Math.random()*vec.colors.length)],n.canonColor=vec.shadeColor2(n.color,.8),n.innerColor=vec.shadeColor2(n.color,.5),n.jetColor=vec.shadeColor2(n.color,.2),n.source="enemy",n.events=[],n.velocity={},n.kill=!1,n.alive=o,n.render=o,n.moveBol=!0,n.sector=h,n.parent=!0,n.id="",n.children=[],n.stopMax=.85,n.random={x:c*n.stopMax,y:s*n.stopMax},n.damage=vec.player.damageEnemy,n.onScene=!1,n.processEvents=function(){if(this.events&&this.events.length)for(var e=0;e<this.events.length;e++)if(this.events[e].timeElapsed+=vec.timeStep,this.events[e].timeElapsed>this.events[e].condition){var t=this.events[e].timeElapsed-this.events[e].condition;this.events[e].timeElapsed=t,this.events[e].handler()}},n.isOnScene=function(){var e=vec.boxCollision(this.x,this.y,this.width*vec.factorX,this.height*vec.factorY,0,0,vec.width,vec.height);e===!0&&(this.onScene=!0)},n.isLeavingCanvas=function(){var e=vec.boxCollision(this.prevX,this.prevY,this.width*vec.factorX,this.height*vec.factorY,-vec.width/2,-vec.height/4,vec.width+vec.width/2,vec.height+vec.height/4),t=vec.boxCollision(this.x,this.y,this.width*vec.factorX,this.height*vec.factorY,-vec.width/2,-vec.height/4,vec.width+vec.width/2,vec.height+vec.height/4);e===!0&&t===!1&&(this.kill=!0,this.render=!1,this.alive=!1,vec.enemyCount--,this.parent===!0&&this.children.length>0&&this.children.forEach(function(e){e.kill=!0,e.render=!1,e.alive=!1,vec.enemyCount--}))},n.stop=function(){if(this.parent===!0){if(this.sector[0]<0){var e=vec.width/2-this.random.x*(vec.width/2-3*this.width*vec.factorX)|0;this.x<e&&(this.moveBol=!1)}else if(this.sector[0]>0){var e=vec.width/2+this.random.x*(vec.width/2-3*this.width*vec.factorX)|0;this.x>e&&(this.moveBol=!1)}if(this.sector[1]<0){var t=vec.height/2-this.random.y*(vec.height/2-this.height*vec.factorY*3)|0;this.y<t&&(this.moveBol=!1)}else if(this.sector[1]>0){var t=vec.height/2+this.random.y*(vec.height/2-this.height*vec.factorY*3)|0;this.y>t&&(this.moveBol=!1)}this.moveBol===!1&&this.children.forEach(function(e){e.moveBol=!1})}},i){case"straight":n.halfWidth=n.width/2,n.halfHeight=n.height/2,n.velocity.x=10*n.sector[0],n.velocity.y=10*n.sector[1],n.health=50,n.fireRate=Math.random()+.2+vec.decreaseFireRate,vec.addEvent(n,n.fireRate,"enemyBasic"),n.move=function(e){this.prevX=this.x,this.prevY=this.y,this.x+=vec.factorX*this.velocity.x*e|0,this.y+=vec.factorY*this.velocity.y*e|0},n.update=function(){this.move(vec.timeStep),this.isLeavingCanvas(),this.processEvents(),this.collision()};break;case"straightStop":n.halfWidth=n.width/2,n.halfHeight=n.height/2,n.velocity.x=10*n.sector[0],n.velocity.y=10*n.sector[1],n.health=100,n.fireRate=Math.random()+.2+vec.decreaseFireRate,vec.addEvent(n,n.fireRate,"enemyBasic"),n.move=function(e){this.prevX=this.x,this.prevY=this.y,this.x+=vec.factorX*this.velocity.x*e|0,this.y+=vec.factorY*this.velocity.y*e|0},n.update=function(){this.moveBol&&this.stop(),this.moveBol&&this.move(vec.timeStep),this.isLeavingCanvas(),this.processEvents(),this.collision()};break;case"sin":n.halfWidth=n.width/2,n.halfHeight=n.height/2,n.velocity.x=10*n.sector[0],n.velocity.y=10*n.sector[1],n.angle=0,n.step=l.n*Math.PI/l.d,n.amplitudeX=a,n.amplitudeY=r,n.distance={x:0,y:0},n.start={x:n.x,y:n.y},n.health=50,n.fireRate=Math.random()+.2+vec.decreaseFireRate,vec.addEvent(n,n.fireRate,"enemyBasic"),n.move=function(e){this.prevX=this.x,this.prevY=this.y,this.distance.x+=vec.factorX*this.velocity.x*e|0,this.distance.y+=vec.factorY*this.velocity.y*e|0,this.x=this.start.x+this.sector[1]*vec.factorX*this.amplitudeX*Math.sin(this.angle)+this.distance.x|0,this.y=this.start.y-this.sector[0]*vec.factorY*this.amplitudeY*Math.sin(this.angle)+this.distance.y|0,this.angle+=this.step*e},n.update=function(){this.move(vec.timeStep),this.isLeavingCanvas(),this.processEvents(),this.collision()};break;case"sinStop":n.halfWidth=n.width/2,n.halfHeight=n.height/2,n.velocity.x=10*n.sector[0],n.velocity.y=10*n.sector[1],n.angle=0,n.step=Math.PI,n.amplitudeX=a,n.amplitudeY=r,n.distance={x:0,y:0},n.start={x:n.x,y:n.y},n.health=100,n.fireRate=Math.random()+.2+vec.decreaseFireRate,n.stopMax=.85,vec.addEvent(n,n.fireRate,"enemyBasic"),n.move=function(e){this.prevX=this.x,this.prevY=this.y,this.distance.x+=vec.factorX*this.velocity.x*e|0,this.distance.y+=vec.factorY*this.velocity.y*e|0,this.x=this.start.x+this.sector[1]*vec.factorX*n.amplitudeX*Math.sin(this.angle)+this.distance.x|0,this.y=this.start.y-this.sector[0]*vec.factorY*n.amplitudeY*Math.sin(this.angle)+this.distance.y|0,this.angle+=this.step*e},n.update=function(){this.moveBol&&this.stop(),this.moveBol&&this.move(vec.timeStep),this.isLeavingCanvas(),this.processEvents(),this.collision()}}this.collision=function(){if(this.onScene||this.isOnScene(),this.onScene){for(var e=!1,t=[],i=0;i<vec.bullets.player.length;i++)vec.bullets.player[i]&&vec.bullets.player[i].alive&&(e=vec.boxCollision(this.x,this.y,this.width*vec.factorX,this.height*vec.factorY,vec.bullets.player[i].x,vec.bullets.player[i].y,vec.bullets.player[i].width*vec.factorX,vec.bullets.player[i].height*vec.factorY),e&&(e=!1,this.health-=this.damage,this.health<=0&&(this.alive=!1,this.render=!1,this.kill=!0,vec.score+=50,vec.enemyCount--),t.push(i)));t&&t.length>0&&vec.removeFromArray(vec.bullets.player,t),t.length=0;for(var i=0;i<vec.bullets.neutral.length;i++)vec.bullets.neutral[i]&&vec.bullets.neutral[i].alive&&(e=vec.boxCollision(this.x,this.y,this.width*vec.factorX,this.height*vec.factorY,vec.bullets.neutral[i].x,vec.bullets.neutral[i].y,vec.bullets.neutral[i].width*vec.factorX,vec.bullets.neutral[i].height*vec.factorY),e&&(e=!1,this.health-=this.damage,this.health<=0&&(this.alive=!1,this.render=!1,this.kill=!0,vec.score+=50,vec.enemyCount--),t.push(i)));t&&t.length>0&&vec.removeFromArray(vec.bullets.neutral,t)}},n.draw=function(){vec.ctx.main.fillStyle=this.color,vec.ctx.main.fillRect(n.x,n.y,n.width*vec.factorX,n.height*vec.factorY),vec.ctx.main.fillStyle=n.jetColor,vec.ctx.main.fillRect(n.x-.2*vec.factorX,n.y+n.height*vec.factorY*.2,n.width*vec.factorX*.4,n.height*vec.factorY-n.height*vec.factorY*.2*2),vec.ctx.main.fillRect(n.x+n.width*vec.factorX-.2*vec.factorX,n.y+n.height*vec.factorY*.2,n.width*vec.factorX*.4,n.height*vec.factorY-n.height*vec.factorY*.2*2),vec.ctx.main.fillRect(n.x+n.width*vec.factorX*.2,n.y-.2*vec.factorY,n.width*vec.factorX-n.width*vec.factorX*.2*2,n.height*vec.factorY*.4),vec.ctx.main.fillRect(n.x+n.width*vec.factorX*.2,n.y+n.height*vec.factorY-.2*vec.factorY,n.width*vec.factorX-n.width*vec.factorX*.2*2,n.height*vec.factorY*.4),vec.ctx.main.fillStyle=this.innerColor,vec.ctx.main.fillRect(n.x+Math.floor(n.width*vec.factorX*.9),n.y+Math.floor(n.height*vec.factorY*.9),n.width-Math.floor(n.width*vec.factorX*.9),n.height-Math.floor(n.height*vec.factorY*.9))}},this.Bullet=function(e,t,i){if(i)var h=i;else var h=this;switch(h.velocity={},h.type=e,h.life=vec.bulletLife,e){case"enemyBasic":h.width=.4,h.height=.8,h.velocity.x=18*t.sector[0],h.velocity.y=18*t.sector[1],h.color=vec.colors[Math.floor(Math.random()*vec.colors.length)],h.render=!0,h.alive=!0,h.kill=!1,h.draw=function(){vec.ctx.main.fillStyle=vec.shadeColor2(this.color,-.8),vec.ctx.main.fillRect(this.x,this.y,Math.floor(this.width*vec.factorX),Math.floor(this.height*vec.factorY)),vec.ctx.main.fillStyle=this.color,vec.ctx.main.fillRect(this.x+this.width*vec.factorX/8,this.y+this.width*vec.factorX/8,Math.floor(this.width*vec.factorX)-2*this.width*vec.factorX/8,Math.floor(this.height*vec.factorY)-2*this.width*vec.factorX/8)},h.move=function(e){this.x+=vec.dir*this.velocity.x*vec.factorX*e|0,this.y+=vec.dir*this.velocity.y*vec.factorY*e|0};break;case"playerBasicVertical":h.width=.4,h.height=.8,h.velocity.x=0,h.velocity.y=18*t.sector[1],h.color=vec.colors[Math.floor(Math.random()*vec.colors.length)],h.render=!0,h.alive=!0,h.kill=!1,h.draw=function(){vec.ctx.main.fillStyle=vec.shadeColor2(this.color,-.8),vec.ctx.main.fillRect(this.x,this.y,Math.floor(this.width*vec.factorX),Math.floor(this.height*vec.factorY)),vec.ctx.main.fillStyle=this.color,vec.ctx.main.fillRect(this.x+this.width*vec.factorX/8,this.y+this.width*vec.factorX/8,Math.floor(this.width*vec.factorX)-2*this.width*vec.factorX/8,Math.floor(this.height*vec.factorY)-2*this.width*vec.factorX/8)},h.move=function(e){this.x+=vec.dir*this.velocity.x*vec.factorX*e|0,this.y+=vec.dir*this.velocity.y*vec.factorY*e|0};break;case"playerBasicHorizontal":h.width=.4,h.height=.8,h.velocity.x=18,h.velocity.y=0,h.color=vec.colors[Math.floor(Math.random()*vec.colors.length)],h.render=!0,h.alive=!0,h.kill=!1,h.draw=function(){vec.ctx.main.fillStyle=vec.shadeColor2(this.color,-.8),vec.ctx.main.fillRect(this.x,this.y,Math.floor(this.width*vec.factorX),Math.floor(this.height*vec.factorY)),vec.ctx.main.fillStyle=this.color,vec.ctx.main.fillRect(this.x+this.width*vec.factorX/8,this.y+this.width*vec.factorX/8,Math.floor(this.width*vec.factorX)-2*this.width*vec.factorX/8,Math.floor(this.height*vec.factorY)-2*this.width*vec.factorX/8)},h.move=function(e){this.x+=vec.dir*this.velocity.x*vec.factorX*e|0,this.y+=vec.dir*this.velocity.y*vec.factorY*e|0};break;case"playerBasicDiagonalR":h.width=.4,h.height=.8,h.velocity.x=18,h.velocity.y=18,h.color=vec.colors[Math.floor(Math.random()*vec.colors.length)],h.render=!0,h.alive=!0,h.kill=!1,h.draw=function(){vec.ctx.main.fillStyle=vec.shadeColor2(this.color,-.8),vec.ctx.main.fillRect(this.x,this.y,Math.floor(this.width*vec.factorX),Math.floor(this.height*vec.factorY)),vec.ctx.main.fillStyle=this.color,vec.ctx.main.fillRect(this.x+this.width*vec.factorX/8,this.y+this.width*vec.factorX/8,Math.floor(this.width*vec.factorX)-2*this.width*vec.factorX/8,Math.floor(this.height*vec.factorY)-2*this.width*vec.factorX/8)},h.move=function(e){this.x+=vec.dir*this.velocity.x*vec.factorX*e|0,this.y+=vec.dir*this.velocity.y*vec.factorY*e|0};break;case"playerBasicDiagonalL":h.width=.4,h.height=.8,h.velocity.x=18,h.velocity.y=-18,h.color=vec.colors[Math.floor(Math.random()*vec.colors.length)],h.render=!0,h.alive=!0,h.kill=!1,h.draw=function(){vec.ctx.main.fillStyle=vec.shadeColor2(this.color,-.8),vec.ctx.main.fillRect(this.x,this.y,Math.floor(this.width*vec.factorX),Math.floor(this.height*vec.factorY)),vec.ctx.main.fillStyle=this.color,vec.ctx.main.fillRect(this.x+this.width*vec.factorX/8,this.y+this.width*vec.factorX/8,Math.floor(this.width*vec.factorX)-2*this.width*vec.factorX/8,Math.floor(this.height*vec.factorY)-2*this.width*vec.factorX/8)},h.move=function(e){this.x+=vec.dir*this.velocity.x*vec.factorX*e|0,this.y+=vec.dir*this.velocity.y*vec.factorY*e|0};break;default:h.x=!1,h.y=!1,h.width=0,h.height=0,h.velocity.x=0,h.velocity.y=0,h.colors=[],h.color="",h.render=!1,h.alive=!1,h.kill=!1,h.health=0,h.draw=function(){return!1},h.move=function(){return!1}}if(h.update=function(){this.move(vec.timeStep)},t){var c=[t.x+t.halfWidth*vec.factorX,t.y+t.halfHeight*vec.factorY];h.x=c[0]+vec.factorX*(vec.dir*t.sector[0]*t.halfWidth+h.width*(vec.dir*t.sector[0]-1)/2)|0,h.y=c[1]+vec.factorY*(vec.dir*t.sector[1]*t.halfHeight+h.height*(vec.dir*t.sector[1]-1)/2)|0}"player"===t.source?vec.bullets.player.push(h):"enemy"===t.source&&vec.bullets.enemies.push(h)};for(var e=0;30>e;e++)this.bullets.pool.push(new this.Bullet(!1,""));this.stage={bg:document.getElementById("bg"),main:document.getElementById("main"),fg:document.getElementById("fg")},this.setCanvas=function(e,t,i,h){e.width=i,e.height=h,e.style.position="absolute",e.style.top=0,e.style.left=0,this.ctx[t]=e.getContext("2d")};for(var t in vec.stage)vec.stage.hasOwnProperty(t)&&vec.setCanvas(vec.stage[t],t,vec.width,vec.height);this.addEvent=function(e,t,i){var h={timeElapsed:0,condition:t,type:i,handler:function(){var t=vec.getFirstDead(vec.bullets.pool);t?vec.Bullet(this.type,e,t):(t=new vec.Bullet(this.type,e),vec.bullets.pool.push(t))}};e.events.push(h)},this.circleXboxCollision=function(e,t,i,h,c,s,o){var a=Math.abs(e-h-s/2),r=Math.abs(t-c-o/2);if(a>s/2+i)return!1;if(r>o/2+i)return!1;if(s/2>=a)return!0;if(o/2>=r)return!0;var l=a-s/2,v=r-o/2;return i*i>=l*l+v*v},this.player.init=function(){this.width=1.5,this.height=1.5,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.x=Math.floor(vec.halfWidth-this.halfWidth*vec.factorX),this.y=Math.floor(3*vec.height/4-this.halfHeight*vec.factorY),this.velocity={x:15,y:15},this.health=vec.maxHealth,this.kill=!1,this.alive=!0,this.render=!0,this.controls={37:!1,38:!1,39:!1,40:!1},this.fireRate=.5,this.maxFireRate=.05,this.fireMaxStart=!1,this.fireMax=!1,this.sector=[0,-1],this.events=[],this.source="player",this.shield={},this.shield.type="",this.shield.outerRadius=Math.floor(this.width*vec.factorX*1.5),this.shield.innerRadius=Math.floor(this.width*vec.factorX*1.3),this.shield.health=0,this.shield.max=100,this.shield.progress=0,this.damage=10,this.damageEnemy=20,this.condition=10,this.timeElapsed=0,this.color=vec.colors[Math.floor(Math.random()*vec.colors.length)],this.fireMaxEvent={on:!1,condition:2,timeElapsed:0,finished:!1,index:!1},this.move=function(e){this.controls[37]?this.x-=Math.floor(this.velocity.x*vec.factorX*e):this.controls[39]&&(this.x+=Math.floor(this.velocity.x*vec.factorX*e)),this.controls[38]?this.y-=Math.floor(this.velocity.y*vec.factorY*e):this.controls[40]&&(this.y+=Math.floor(this.velocity.y*vec.factorY*e))},this.keepInBounds=function(){this.x+this.width*vec.factorX>vec.width?this.x=vec.width-this.width*vec.factorX:this.x<0&&(this.x=0),this.y+this.height*vec.factorY>vec.height?this.y=vec.height-this.height*vec.factorY:this.y<0&&(this.y=0)},this.damagePlayer=function(e,t){if(this.color===t)return vec.score+=20,this.health+=e,void(this.health>vec.maxHealth&&(this.health=vec.maxHealth));if(this.shield.health>0){if(this.shield.type===t)return vec.score+=20,this.shield.health+=e,void(this.shield.health>this.shield.max&&(this.shield.health=this.shield.max));if(e<=this.shield.health)this.shield.health-=e;else{var i=e-this.shield.health;this.shield.health=0,this.health-=i}}else this.health-=e},this.draw=function(){this.shield.health>0&&(vec.ctx.main.fillStyle=vec.hex2rgba(vec.shadeColor2(this.shield.type,-.2),this.shield.progress),vec.ctx.main.beginPath(),vec.ctx.main.arc(this.x+Math.floor(this.width*vec.factorX/2),this.y+Math.floor(this.height*vec.factorY/2),this.shield.outerRadius,0,2*Math.PI,!1),vec.ctx.main.fill(),vec.ctx.main.fillStyle=vec.shadeColor2(this.shield.type,.5),vec.ctx.main.beginPath(),vec.ctx.main.arc(this.x+Math.floor(this.width*vec.factorX/2),this.y+Math.floor(this.height*vec.factorY/2),this.shield.innerRadius,0,2*Math.PI,!1),vec.ctx.main.fill()),vec.ctx.main.fillStyle=this.color,vec.ctx.main.fillRect(this.x,this.y,Math.floor(this.width*vec.factorX),Math.floor(this.height*vec.factorY)),vec.ctx.main.fillStyle=vec.shadeColor2(this.color,.3);var e=Math.floor(this.width*vec.factorX/10);vec.ctx.main.fillRect(this.x+e,this.y+e,Math.floor(this.width*vec.factorX-2*e),Math.floor(this.height*vec.factorY-2*e))},this.processEvents=function(){if(this.events&&this.events.length)for(var e=0;e<this.events.length;e++)if(this.events[e].timeElapsed+=vec.timeStep,this.events[e].timeElapsed>this.events[e].condition){var t=this.events[e].timeElapsed-this.events[e].condition;this.events[e].timeElapsed=t,this.events[e].handler()}},this.updateShieldProgress=function(){this.shield.progress=this.shield.health/this.shield.max},this.collision=function(){for(var e=!1,t=[],i=0;i<vec.bullets.enemies.length;i++)vec.bullets.enemies[i].alive&&(e=this.shield.health>0?vec.circleXboxCollision(this.x+Math.floor(this.width*vec.factorX/2),this.y+Math.floor(this.height*vec.factorY/2),this.shield.innerRadius,vec.bullets.enemies[i].x,vec.bullets.enemies[i].y,vec.bullets.enemies[i].width*vec.factorX,vec.bullets.enemies[i].height*vec.factorY):vec.boxCollision(this.x,this.y,this.width*vec.factorX,this.height*vec.factorY,vec.bullets.enemies[i].x,vec.bullets.enemies[i].y,vec.bullets.enemies[i].width*vec.factorX,vec.bullets.enemies[i].height*vec.factorY),e&&(e=!1,vec.bullets.enemies[i].kill=!0,vec.bullets.enemies[i].render=!1,vec.bullets.enemies[i].alive=!1,t.push(i),this.damagePlayer(this.damage,vec.bullets.enemies[i].color),this.health<=0&&(vec.gameOver=!0,this.health=0)));t&&t.length>0&&vec.removeFromArray(vec.bullets.enemies,t),t.length=0;for(var i=0;i<vec.bullets.neutral.length;i++)vec.bullets.neutral[i].alive&&(e=this.shield.health>0?vec.circleXboxCollision(this.x+Math.floor(this.width*vec.factorX/2),this.y+Math.floor(this.height*vec.factorY/2),this.shield.innerRadius,vec.bullets.neutral[i].x,vec.bullets.neutral[i].y,vec.bullets.neutral[i].width*vec.factorX,vec.bullets.neutral[i].height*vec.factorY):vec.boxCollision(this.x,this.y,this.width*vec.factorX,this.height*vec.factorY,vec.bullets.neutral[i].x,vec.bullets.neutral[i].y,vec.bullets.neutral[i].width*vec.factorX,vec.bullets.neutral[i].height*vec.factorY),e&&(e=!1,vec.bullets.neutral[i].kill=!0,vec.bullets.neutral[i].render=!1,vec.bullets.neutral[i].alive=!1,t.push(i),this.damagePlayer(this.damage,vec.bullets.neutral[i].color),this.health<=0&&(vec.gameOver=!0,this.health=0)));t&&t.length>0&&vec.removeFromArray(vec.bullets.neutral,t)},this.updateEvents=function(){this.fireMaxEvent.on&&(this.fireMaxEvent.timeElapsed+=vec.timeStep,this.fireMaxEvent.timeElapsed>this.fireMaxEvent.condition&&(this.fireMaxEvent.on=!1,this.fireMaxEvent.timeElapsed=0,this.fireMaxEvent.finished=!0),this.fireMaxEvent.finished&&(this.fireMaxEvent.finished=!1,this.events.splice(this.fireMaxEvent.index,1),this.fireMaxEvent.index=!1))},this.changeColor=function(){if(this.timeElapsed+=vec.timeStep,this.timeElapsed>this.condition){this.color=vec.colors[Math.floor(Math.random()*vec.colors.length)];var e=this.timeElapsed-this.condition;this.timeElapsed=e}},this.update=function(){this.move(vec.timeStep),this.keepInBounds(),this.processEvents(),this.collision(),this.updateShieldProgress(),this.updateEvents(),this.changeColor(),vec.gameOver&&(this.alive=!1,this.render=!1,this.kill=!0,vec.pause.active=!0)},vec.addEvent(this,this.fireRate,"playerBasicVertical")},this.player.init(),this.setNewPosition=function(e){e.x=e.x*this.scaleX,e.y=e.y*this.scaleY},this.control=function(e){if("keydown"===e.type)var t=!0;else var t=!1;switch("keydown"===e.type&&(vec.gameOver&&32==e.keyCode&&vec.init(),vec.introduction&&32==e.keyCode&&(vec.introduction=!1,vec.div3.parentNode.removeChild(vec.div3),vec.div2.parentNode.removeChild(vec.div2),vec.div2=null,vec.div3=null)),e.keyCode){case 37:vec.player.controls[37]=t;break;case 39:vec.player.controls[39]=t;break;case 38:vec.player.controls[38]=t;break;case 40:vec.player.controls[40]=t;break;default:return}e.preventDefault()},this.updateRatioAndFactorOnResize=function(){this.ratioX=this.width/this.baseWidth,this.ratioY=this.height/this.baseHeight,this.factorX=this.unit*this.ratioX,this.factorY=this.unit*this.ratioY},this.updatePositionsOnResize=function(){this.group.update&&this.group.update.length&&this.group.update.forEach(function(e){e.constructor&&e.constructor===Array?e.forEach(function(e){vec.setNewPosition(e)}):vec.setNewPosition(e)})},this.updateGameSizeOnResize=function(){this.widthOld=this.width,this.heightOld=this.height,this.windowWidth=Math.floor(window.innerWidth),this.windowHeight=Math.floor(window.innerHeight),this.ratioW=this.windowWidth/this.baseWidth,this.ratioH=this.windowHeight/this.baseHeight,this.ratioW<this.ratioH?(this.width=Math.floor(this.windowWidth),this.height=this.width*this.baseHeight/this.baseWidth):(this.height=Math.floor(this.windowHeight),this.width=this.height*this.baseWidth/this.baseHeight),this.div.style.width=this.width+"px",this.div.style.height=this.height+"px",this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.scaleX=this.width/this.widthOld,this.scaleY=this.height/this.heightOld},this.resize=function(){vec.updateGameSizeOnResize(),vec.updateRatioAndFactorOnResize(),vec.updatePositionsOnResize();for(var e in vec.stage)vec.stage.hasOwnProperty(e)&&(vec.stage[e].width=vec.width,vec.stage[e].height=vec.height);vec.render()},this.blur=function(){vec.player.controls={37:!1,38:!1,39:!1,40:!1},vec.pause.active=!0,vec.pause.state=!0,vec.pause.time=vec.lastTime?vec.lastTime:0},this.focus=function(){vec.pause.active=!1},this.update=function(){this.group&&this.group.update&&this.group.update.length&&this.group.update.forEach(function(e){void 0===e.length&&e.alive&&e.update?e.update():e.length&&e.length>0&&e.forEach(function(e){e.alive&&e.update&&e.update()})})},this.HUD={},this.HUD.init=function(){this.alive=!0,this.render=!0,this.healthWidth=Math.floor(2*vec.width/7),this.healthFill=1,this.healthHeight=Math.floor(vec.height/28),this.healthBorder=Math.floor(this.healthHeight/10),this.scoreSize=Math.floor(vec.height/35),this.healthSize=Math.floor(vec.height/40),this.scoreText2,this.update=function(){this.healthFill=vec.player.health/vec.maxHealth
},this.draw=function(){vec.ctx.fg.font="bold "+this.scoreSize+"px Verdana",this.scoreText=vec.ctx.fg.measureText("SCORE"),this.scoreText2=vec.ctx.fg.measureText(vec.score),vec.ctx.fg.fillStyle="#ffffff",vec.ctx.fg.fillText("SCORE",vec.width-Math.floor(1.2*this.scoreText.width),Math.floor(1.5*this.scoreSize)),vec.ctx.fg.fillText(vec.score,vec.width-Math.floor(this.scoreText.width/5+this.scoreText2.width),3*this.scoreSize),vec.ctx.fg.fillStyle="#802426",vec.ctx.fg.font="bold "+this.healthSize+"px Verdana",this.healthText=vec.ctx.fg.measureText("HEALTH"),vec.ctx.fg.fillText("HEALTH",vec.width-Math.floor(1.2*this.healthWidth),vec.height-Math.floor(2.15*this.healthHeight)),vec.ctx.fg.strokeStyle="#802426",vec.ctx.fg.lineWidth=this.healthBorder,vec.ctx.fg.strokeRect(vec.width-Math.floor(1.2*this.healthWidth),vec.height-2*this.healthHeight,this.healthWidth,this.healthHeight),vec.ctx.fg.fillStyle="#FD0006",vec.ctx.fg.fillRect(vec.width-Math.floor(1.2*this.healthWidth)+Math.floor(this.healthBorder/2),vec.height-2*this.healthHeight+Math.floor(this.healthBorder/2),Math.floor(this.healthWidth*this.healthFill)-this.healthBorder,this.healthHeight-this.healthBorder)}},this.HUD.init(),vec.group.update.push(this.HUD),vec.group.render.push(this.HUD),this.hex2rgba=function(e,t){var i=parseInt(e.slice(1,3),16),h=parseInt(e.slice(3,5),16),c=parseInt(e.slice(5,7),16);return"rgba("+i+", "+h+", "+c+", "+t+")"},this.bgRender={},this.bgRender.init=function(){this.alive=!0,this.render=!0,this.path=[],this.path2=[],this.path3=[],this.path4=[],this.path5=[],this.path6=[],this.path7=[],this.velocity={},this.velocity.y=6,this.progress=0,this.condition=60,this.timeElapsed=0,this.steps=10,this.cloudPositions=[],this.cloudCount=0;for(var e=0,t=0;t<this.steps+2;t++){t>0&&(e+=Math.floor(vec.height/this.steps));var i=Math.floor(Math.random()*(1+vec.width-3*vec.width/7-vec.width/2))+Math.floor(vec.width/2);this.path.unshift([i,e]),this.path3.unshift([i+vec.width/7,e]),this.path4.unshift([i+2*vec.width/5,e]),this.path5.unshift([i-vec.width/15,e]),i=Math.floor(Math.random()*(1+vec.width/4-vec.width/6))+Math.floor(vec.width/6),this.path2.unshift([i,e]),this.path6.unshift([i+vec.width/15,e]),this.path7.unshift([i-vec.width/20,e])}this.drawClouds=function(){this.cloudPositions.forEach(function(e){vec.ctx.bg.fillStyle=e[5],vec.ctx.bg.moveTo(e[0],e[1]),vec.ctx.bg.beginPath(),vec.ctx.bg.arc(e[0],e[1],e[2],0,2*Math.PI,!1),vec.ctx.bg.fill()})},this.createClouds=function(e,t){var i=Math.floor(21*Math.random())-10,h=Math.floor(8*Math.random())+3,c=vec.width/12,s=vec.width/15,o=Math.floor(Math.random()*(1+c-s))+s,a=["#7F8FA7","#98B2D8","#EAEAEA","#C0E1FF"],r=a[Math.floor(Math.random()*a.length)];this.cloudPositions.push([e,t,o,i,h,r]),this.cloudCount++;for(var l,v=Math.floor(18*Math.random())+3,n=Math.floor(Math.random()*(1+v-3))+3,d=0,f=e,g=t,u=o,p=0;n>p;p++)d>2&&(f=this.cloudPositions[this.cloudPositions.length-1][0],g=this.cloudPositions[this.cloudPositions.length-1][1],d=0),o=Math.floor(Math.random()*(1+c-s))+s,l=[Math.floor(3*Math.random())-1,Math.floor(3*Math.random())-1],this.cloudPositions.push([f+l[0]*u,g+l[1]*u,o,i,h,r]),d++,this.cloudCount++,u=o},this.draw=function(){vec.ctx.bg.fillStyle="#1B69DB",vec.ctx.bg.fillRect(0,0,vec.width,vec.height),vec.ctx.bg.fillStyle="#77C1FF",vec.ctx.bg.moveTo(0,0),vec.ctx.bg.beginPath();for(var e=this.path6.length-1;e>=0;e--)vec.ctx.bg.lineTo(this.path6[e][0],this.path6[e][1]);vec.ctx.bg.lineTo(0,vec.height),vec.ctx.bg.lineTo(0,0),vec.ctx.bg.fill(),vec.ctx.bg.moveTo(vec.width,0),vec.ctx.bg.beginPath();for(var e=this.path5.length-1;e>=0;e--)vec.ctx.bg.lineTo(this.path5[e][0],this.path5[e][1]);vec.ctx.bg.lineTo(vec.width,vec.height),vec.ctx.bg.lineTo(vec.width,0),vec.ctx.bg.fill(),vec.ctx.bg.fillStyle="#FDFF78",vec.ctx.bg.moveTo(0,0),vec.ctx.bg.beginPath();for(var e=this.path2.length-1;e>=0;e--)vec.ctx.bg.lineTo(this.path2[e][0],this.path2[e][1]);vec.ctx.bg.lineTo(0,vec.height),vec.ctx.bg.lineTo(0,0),vec.ctx.bg.fill(),vec.ctx.bg.moveTo(vec.width,0),vec.ctx.bg.beginPath();for(var e=this.path.length-1;e>=0;e--)vec.ctx.bg.lineTo(this.path[e][0],this.path[e][1]);vec.ctx.bg.lineTo(vec.width,vec.height),vec.ctx.bg.lineTo(vec.width,0),vec.ctx.bg.fill(),vec.ctx.bg.fillStyle="#FFD878",vec.ctx.bg.moveTo(0,0),vec.ctx.bg.beginPath();for(var e=this.path7.length-1;e>=0;e--)vec.ctx.bg.lineTo(this.path7[e][0],this.path7[e][1]);vec.ctx.bg.lineTo(0,vec.height),vec.ctx.bg.lineTo(0,0),vec.ctx.bg.fill(),vec.ctx.bg.fillStyle="#119E1B",vec.ctx.bg.moveTo(vec.width,0),vec.ctx.bg.beginPath();for(var e=this.path3.length-1;e>=0;e--)vec.ctx.bg.lineTo(this.path3[e][0],this.path3[e][1]);vec.ctx.bg.lineTo(vec.width,vec.height),vec.ctx.bg.lineTo(vec.width,0),vec.ctx.bg.fill(),vec.ctx.bg.fillStyle="#727272",vec.ctx.bg.moveTo(vec.width,0),vec.ctx.bg.beginPath();for(var e=this.path4.length-1;e>=0;e--)vec.ctx.bg.lineTo(this.path4[e][0],this.path4[e][1]);vec.ctx.bg.lineTo(vec.width,vec.height),vec.ctx.bg.lineTo(vec.width,0),vec.ctx.bg.fill(),this.drawClouds(),vec.ctx.bg.fillStyle="rgba(224, 232, 244, 0.25)",vec.ctx.bg.fillRect(0,0,vec.width,vec.height),vec.ctx.bg.fillStyle=vec.hex2rgba(vec.player.color,.25),vec.ctx.bg.fillRect(0,0,vec.width,vec.height)},this.update=function(){for(var e=0;e<this.path2.length;e++)this.path2[e][1]+=Math.floor(this.velocity.y*vec.factorY*vec.timeStep);for(var e=0;e<this.path.length;e++)this.path[e][1]+=Math.floor(this.velocity.y*vec.factorY*vec.timeStep);for(var e=0;e<this.path3.length;e++)this.path3[e][1]+=Math.floor(this.velocity.y*vec.factorY*vec.timeStep);for(var e=0;e<this.path4.length;e++)this.path4[e][1]+=Math.floor(this.velocity.y*vec.factorY*vec.timeStep);for(var e=0;e<this.path5.length;e++)this.path5[e][1]+=Math.floor(this.velocity.y*vec.factorY*vec.timeStep);for(var e=0;e<this.path6.length;e++)this.path6[e][1]+=Math.floor(this.velocity.y*vec.factorY*vec.timeStep);for(var e=0;e<this.path7.length;e++)this.path7[e][1]+=Math.floor(this.velocity.y*vec.factorY*vec.timeStep);if(this.path[this.path.length-1][1]>-vec.height/10){var t=-Math.floor(vec.height/5),i=Math.floor(Math.random()*(1+vec.width-3*vec.width/7-vec.width/2))+Math.floor(vec.width/2);this.path.push([i,t]),this.path3.push([i+vec.width/7,t]),this.path4.push([i+2*vec.width/5,t]),this.path5.push([i-vec.width/15,t]),i=Math.floor(Math.random()*(1+vec.width/4-vec.width/6))+Math.floor(vec.width/6),this.path2.push([i,t]),this.path6.push([i+vec.width/15,t]),this.path7.push([i-vec.width/20,t])}for(var e=0;e<this.path.length;e++)this.path[e][1]>vec.height+2*vec.height/10&&(this.path.splice(e,1),this.path2.splice(e,1),this.path3.splice(e,1),this.path4.splice(e,1));if(this.cloudCount<20&&this.createClouds(Math.floor(Math.random()*(1+vec.width+vec.width/5))-Math.floor(vec.width/5),-Math.floor(vec.height/5)),this.cloudCount>0)for(var h=0;h<this.cloudPositions.length;h++)this.cloudPositions[h][0]+=this.cloudPositions[h][3]*vec.factorX*vec.timeStep,this.cloudPositions[h][1]+=this.cloudPositions[h][4]*vec.factorY*vec.timeStep,(this.cloudPositions[h][0]>vec.width+vec.width/3||this.cloudPositions[h][0]<0-vec.width/3||this.cloudPositions[h][1]>vec.height+vec.height/3)&&(this.cloudPositions.splice(h,1),this.cloudCount--)}},this.bgRender.init(),vec.group.render.push(this.bgRender),vec.group.update.push(this.bgRender),this.render=function(){for(var e in this.ctx)this.ctx.hasOwnProperty(e)&&this.ctx[e].clearRect(0,0,this.width,this.height);this.group&&this.group.render&&this.group.render.length&&this.group.render.forEach(function(e){void 0===e.length&&e.alive&&e.render?e.draw():e.length&&e.length>0&&e.forEach(function(e){e.alive&&e.render&&e.draw()})})};for(var e=0;30>e;e++)this.enemies.push(new this.Enemy(0,0,"straight",[0,1],.2,.2,!1,1,1,1));this.store=!1,this.storedScore=!1,this.storeScore=function(){if(this.storageAvailable("localStorage")&&!this.store){var e=window.localStorage;this.storedScore=e.getItem("vecScore"),(!this.storedScore||this.score>this.storedScore)&&e.setItem("vecScore",vec.score),this.store=!0}},this.storageAvailable=function(e){try{var t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(h){return!1}},this.introduction=!0,this.startScreen=function(){vec.ctx.fg.fillStyle="#FFCD77",vec.ctx.fg.fillRect(0,0,vec.width,vec.height),vec.ctx.fg.fillStyle=vec.shadeColor2("#FFCD77",.4);var e=vec.height/10;vec.ctx.fg.font="bold "+e+"px Verdana";var t=vec.ctx.fg.measureText("BoxBox");vec.ctx.fg.fillText("BoxBox",vec.width/2-t.width/2,e);var t="Welcome strider! You have managed to hijack the enemy's newest ship but a huge army is all around you, how long will you manage to resist!?<br><br><h2>Controls</h2>Arrows: <b>LEFT</b>, <b>UP</b>, <b>RIGHT</b>, <b>DOWN</b>.<br><h3>Instructions</h3>Your ship changes modes with time, it's determined by the color of your ship - the effect is so strong that even the environment is affected and changes it's color tone according to your ship! Getting hit by a laser of the same color as your ship <b>regains your health</b> and increases your score while other lasers just damage you so be vary!<br>Make sure you <b>collect various bonuses</b> which float in the air around they provide you your only advantage in this last mission of yours!<br><i>For example a shield with a specific color completely protects you against lasers of the same type as the shield while it's getting damaged instead of you when hit by other lasers.</i><br><h3>GOOD LUCK!</h3><br><center><b>Press SPACE bar to START the game!</b></center>";vec.div3.innerHTML=t,vec.div3.style.fontSize=Math.floor(vec.height/35)+"px",vec.div3.style.color=vec.shadeColor2("#FFCD77",-.4),vec.div3.style.width=Math.floor(vec.width-.1*vec.width)+"px",vec.div3.style.height=Math.floor(vec.height-.15*vec.height)+"px",vec.div3.style.position="relative",vec.div3.style.top="12%",vec.div3.style.left="50%",vec.div3.style.transform="translate(-50%)",vec.div3.style.OTransform="translate(-50%)",vec.div3.style.msTransform="translate(-50%)",vec.div3.style.MozTransform="translate(-50%)",vec.div3.style.WebkitTransform="translate(-50%)",vec.div2.style.width=vec.width+"px",vec.div2.style.height=vec.height+"px",vec.div2.style.position="fixed",vec.div2.style.left="50%",vec.div2.style.top="50%",vec.div2.style.transform="translate(-50%,-50%)",vec.div2.style.OTransform="translate(-50%,-50%)",vec.div2.style.msTransform="translate(-50%,-50%)",vec.div2.style.MozTransform="translate(-50%,-50%)",vec.div2.style.WebkitTransform="translate(-50%,-50%)"},this.div2=document.createElement("div"),this.div3=document.createElement("div"),this.div.appendChild(this.div2),this.div2.appendChild(this.div3),this.gameOverScreen=function(){var e=3*vec.width/4;if(this.storedScore)var t=6*vec.height/13;else var t=3*vec.height/8;var i=vec.width/2-e/2,h=vec.height/2-t/2,c=Math.floor(vec.height/15);vec.ctx.fg.fillStyle=vec.player.color,vec.ctx.fg.fillRect(i,h,e,t);var s=e/25;vec.ctx.fg.fillStyle=vec.shadeColor2(vec.player.color,-.3),vec.ctx.fg.fillRect(i+s,h+s,e-2*s,t-2*s),vec.ctx.fg.fillStyle=vec.player.color,vec.ctx.fg.font="bold "+c+"px Verdana";var o=vec.ctx.fg.measureText("Game Over");if(vec.ctx.fg.fillText("Game Over",i+e/2-o.width/2,h+1.2*c),this.storedScore){c=Math.floor(vec.height/20),vec.ctx.fg.font="bold "+c+"px Verdana";var o=vec.ctx.fg.measureText("Best Record");vec.ctx.fg.fillStyle=vec.shadeColor2(vec.player.color,.2),vec.ctx.fg.fillText("Best Record",i+e/2-o.width/2,h+3*c),c=Math.floor(vec.height/20),vec.ctx.fg.font="bold "+c+"px Verdana";var o=vec.ctx.fg.measureText(this.storedScore);vec.ctx.fg.fillText(this.storedScore,i+e/2-o.width/2,h+4.1*c),vec.ctx.fg.fillStyle=vec.player.color,c=Math.floor(vec.height/20),vec.ctx.fg.font="bold "+c+"px Verdana";var o=vec.ctx.fg.measureText("Your Score");vec.ctx.fg.fillText("Your Score",i+e/2-o.width/2,h+5.1*c),vec.ctx.fg.font="bold "+c+"px Verdana";var o=vec.ctx.fg.measureText(vec.score);vec.ctx.fg.fillText(vec.score,i+e/2-o.width/2,h+6.15*c),c=Math.floor(vec.height/25),vec.ctx.fg.font="bold "+c+"px Verdana";var o=vec.ctx.fg.measureText("Press SPACE bar to");vec.ctx.fg.fillStyle=vec.shadeColor2(vec.player.color,.8),vec.ctx.fg.fillText("Press SPACE bar to",i+e/2-o.width/2,h+9.5*c),c=Math.floor(vec.height/15),vec.ctx.fg.font="bold "+c+"px Verdana";var o=vec.ctx.fg.measureText("Try Again!");vec.ctx.fg.fillText("Try Again!",i+e/2-o.width/2,h+6.5*c)}else{vec.ctx.fg.fillStyle=vec.shadeColor2(vec.player.color,.2),c=Math.floor(vec.height/20),vec.ctx.fg.font="bold "+c+"px Verdana";var o=vec.ctx.fg.measureText("Your Score");vec.ctx.fg.fillText("Your Score",i+e/2-o.width/2,h+3*c),vec.ctx.fg.font="bold "+c+"px Verdana";var o=vec.ctx.fg.measureText(vec.score);vec.ctx.fg.fillText(vec.score,i+e/2-o.width/2,h+4.2*c),c=Math.floor(vec.height/25),vec.ctx.fg.font="bold "+c+"px Verdana";var o=vec.ctx.fg.measureText("Press SPACE bar to");vec.ctx.fg.fillStyle=vec.shadeColor2(vec.player.color,.8),vec.ctx.fg.fillText("Press SPACE bar to",i+e/2-o.width/2,h+7*c),c=Math.floor(vec.height/15),vec.ctx.fg.font="bold "+c+"px Verdana";var o=vec.ctx.fg.measureText("Try Again!");vec.ctx.fg.fillText("Try Again!",i+e/2-o.width/2,h+5*c)}},this.touchControlStart=function(e){return e.preventDefault(),vec.gameOver?void vec.init():vec.introduction?(vec.introduction=!1,vec.div3.parentNode.removeChild(vec.div3),vec.div2.parentNode.removeChild(vec.div2),vec.div2=null,void(vec.div3=null)):(e.touches[0].pageX>2*window.innerWidth/3?vec.player.controls[39]=!0:e.touches[0].pageX<window.innerWidth/3&&(vec.player.controls[37]=!0),void(e.touches[0].pageY>2*window.innerHeight/3?vec.player.controls[40]=!0:e.touches[0].pageY<window.innerHeight/3&&(vec.player.controls[38]=!0)))},this.touchControlEnd=function(e){e.preventDefault(),vec.player.controls[37]=!1,vec.player.controls[39]=!1,vec.player.controls[40]=!1,vec.player.controls[38]=!1}},vec.init(),window.addEventListener("keydown",vec.control,!1),window.addEventListener("keyup",vec.control,!1),window.addEventListener("resize",vec.resize,!1),window.addEventListener("blur",vec.blur,!1),window.addEventListener("focus",vec.focus,!1),window.addEventListener("touchstart",vec.touchControlStart,!1),window.addEventListener("touchend",vec.touchControlEnd,!1),vec.gameLoop=function(e){e&&!vec.pause.active&&(vec.pause.state&&(vec.lastTime=e/1e3-vec.timeStep,vec.pause.state=!1),null!==vec.lastTime&&(vec.timeStep=e/1e3-vec.lastTime),vec.lastTime=e/1e3,vec.introduction||(vec.gameOver||vec.update(),vec.render(),vec.gameOver&&(vec.store||vec.storeScore(),vec.gameOverScreen())),vec.introduction&&vec.startScreen()),window.requestAnimationFrame(vec.gameLoop)},vec.gameLoop();</script>





	</body>
	
</html>
